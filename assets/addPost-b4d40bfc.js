import{p as r,g as l,m as i}from"./main-314339aa.js";function y(e,t="yyyy/mm/dd"){if(typeof e=="number"&&(e=new Date(e)),t="yyyy/mm/dd"){const s=e.getFullYear(),n=e.getMonth()+1,o=e.getDate();return`${s}/${n}/${o}`}else return e.tolocalString()}const a=document.querySelector("#postImg"),m=document.querySelector("#addPostImg"),d=document.querySelector("#daylineType"),c=document.querySelector("#daylineDays"),p=document.querySelector("#addPostTitle"),f=document.querySelector("#addPostText"),g=document.querySelector("#submitPostBtn");(async()=>{const e=await r("get",`600/users/${l("userId")}`,"",!0),{daylineType:t,daylineDay:s}=e.data;c.textContent=s?s+1:1,d.textContent=t,e.data.posts})();let u="";m.addEventListener("change",function(e){const t=e.target.files[0];if(t){const s=new FileReader;s.onload=function(n){u=n.target.result.split(",")[1],a.src=n.target.result},s.readAsDataURL(t),a.classList.contains("d-none")&&a.classList.remove("d-none")}});g.addEventListener("click",async function(e){e.preventDefault();const t=new Date,s={content:{postImage:{img64:u},title:p.value,textBody:f.value,daylineDay:+c.textContent,daylineType:d.textContent},createDay:y(t,"yyyy/mm/dd"),userId:+l("userId")};try{const n=await r("post","664/posts",s,!0),o=await r("patch",`600/users/${l("userId")}`,{isDoneToday:!0,updateDate:t.getTime(),daylineDay:+c.textContent},!0);i("success","發布日更成功!","",{html:'<p class="fs-4">已成功發布貼文!</p>',timer:1800,timerProgressBar:!0,allowEnterKey:!1,allowOutsideClick:!1,allowEscapeKey:!1,showConfirmButton:!1}).then(()=>{location.href=`./post.html?id=${n.data.id}`})}catch{}});
